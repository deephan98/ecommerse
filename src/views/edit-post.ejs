<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Product Post</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/animation.css">
  <style>
    .summary-card {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .summary-card h2 {
      margin-bottom: 10px;
    }
    .summary-card .summary-row {
      margin-bottom: 8px;
    }
    .media-preview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 10px;
    }
    .media-item img, .media-item video {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 4px;
    }
    .media-item {
      position: relative;
      border: 1px solid #ddd;
      border-radius: 4px;
      overflow: hidden;
      background: #fff;
    }
    .no-media {
      color: #888;
      font-style: italic;
      margin: 10px 0;
    }
    .delete-media {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(255, 0, 0, 0.7);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .delete-media:hover {
      background: rgba(255, 0, 0, 0.9);
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="animate-fade-in">
      <h1 class="animate-slide-left">Edit Product Post</h1>
      <nav class="animate-slide-right">
        <a href="/" class="hover-grow">Home</a>
        <a href="/admin" class="hover-grow">Admin</a>
        <a href="/post" class="hover-grow">All Posts</a>
        <a href="/products" class="hover-grow">All Products</a>
      </nav>
    </header>
    <main>
      <section class="admin-panel reveal">
        <h2 class="animate-slide-up">Edit Product: <%= post.name %></h2>
        <p>Update the details and media for this product.</p>
        <form action="/post/edit/<%= post.id %>" method="POST" enctype="multipart/form-data" id="editForm">
          <div class="form-group">
            <label for="name">Product Name:</label>
            <input type="text" id="name" name="name" value="<%= post.name %>" required>
          </div>
          <div class="form-group">
            <label for="price">Price ($):</label>
            <input type="number" id="price" name="price" step="0.01" min="0" value="<%= post.price %>" required>
          </div>
          <div class="form-group">
            <label for="description">Description:</label>
            <textarea id="description" name="description" rows="4" required><%= post.description %></textarea>
          </div>
          <div class="form-group">
            <label for="productImages">Add More Images:</label>
            <input type="file" id="productImages" name="productImages" accept="image/*" multiple>
            <div id="imagePreview" class="media-preview"></div>
          </div>
          <div class="form-group">
            <label for="productVideos">Add More Videos:</label>
            <input type="file" id="productVideos" name="productVideos" accept="video/*" multiple>
            <div id="videoPreview" class="media-preview"></div>
          </div>
          
          <h3>Current Images</h3>
          <div class="media-preview">
            <% if (post.images && post.images.length > 0) { %>
              <% post.images.forEach(function(image, idx) { %>
                <div class="media-item">
                  <img src="<%= image %>" alt="<%= post.name %> image">
                  <button type="button" class="delete-media" data-type="image" data-path="<%= image %>" data-index="<%= idx %>">×</button>
                </div>
              <% }); %>
            <% } else { %>
              <div class="no-media">No images</div>
            <% } %>
          </div>
          
          <h3>Current Videos</h3>
          <div class="media-preview">
            <% if (post.videos && post.videos.length > 0) { %>
              <% post.videos.forEach(function(video, idx) { %>
                <div class="media-item">
                  <video src="<%= video %>" controls></video>
                  <button type="button" class="delete-media" data-type="video" data-path="<%= video %>" data-index="<%= idx %>">×</button>
                </div>
              <% }); %>
            <% } else { %>
              <div class="no-media">No videos</div>
            <% } %>
          </div>
          
          <button type="submit" class="btn hover-grow animate-pulse">Update Post</button>
        </form>
      </section>
    </main>
    <footer class="animate-fade-in">
      <p>&copy; <%= new Date().getFullYear() %> Simple E-commerce</p>
    </footer>
  </div>
  
  <script>
    // Preview uploaded images
    document.getElementById('productImages').addEventListener('change', function(e) {
      const preview = document.getElementById('imagePreview');
      preview.innerHTML = '';
      
      if (this.files) {
        Array.from(this.files).forEach(file => {
          const reader = new FileReader();
          reader.onload = function(e) {
            const div = document.createElement('div');
            div.className = 'media-item';
            div.innerHTML = `<img src="${e.target.result}" alt="Image preview">`;
            preview.appendChild(div);
          }
          reader.readAsDataURL(file);
        });
      }
    });
    
    // Preview uploaded videos
    document.getElementById('productVideos').addEventListener('change', function(e) {
      const preview = document.getElementById('videoPreview');
      preview.innerHTML = '';
      
      if (this.files) {
        Array.from(this.files).forEach(file => {
          const reader = new FileReader();
          reader.onload = function(e) {
            const div = document.createElement('div');
            div.className = 'media-item';
            div.innerHTML = `<video src="${e.target.result}" controls></video>`;
            preview.appendChild(div);
          }
          reader.readAsDataURL(file);
        });
      }
    });
    
    // Delete media
    document.querySelectorAll('.delete-media').forEach(button => {
      button.addEventListener('click', function() {
        const mediaType = this.getAttribute('data-type');
        const mediaPath = this.getAttribute('data-path');
        const mediaItem = this.parentElement;
        
        if (confirm(`Are you sure you want to delete this ${mediaType}?`)) {
          fetch('/admin/delete-media', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              mediaPath: mediaPath,
              type: mediaType
            }),
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              mediaItem.remove();
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
        }
      });
    });
  </script>
</body>
</html>